# Crafter

## Мотивация

В нашей компании разрабатывается большое количество JSON API, которые необходимо согласовывать, описывать, отслеживать изменения и показывать удобную документацию большому кругу лиц. Поэтому возникает необходимость удобных формата и средства для работы с документацией. Исторически в компании происходил выбор между [API Blueprint](https://apiblueprint.org/) и [Swagger](https://swagger.io/). Предпочтение было отдано первому по нескольким причинам. Во-первых, исходный код документации, описанной с помощью API Blueprint, проще воспринимается человеком. Во-вторых, на момент исследования в Swagger не хватало ряда важных возможностей (например, One Of).

API Blueprint состоит из двух частей: парсер формата apib [Drafter](https://github.com/apiaryio/drafter) и рендерер HTML-версии документации — [aglio](https://github.com/danielgtaylor/aglio).

Drafter — это библиотека, которая получает на вход текст в формате apib и возвращает распарсенное дерево в формате [API Elements](http://api-elements.readthedocs.io/en/latest/) в виде YAML/JSON. Drafter реализован на языке программирования C++. Код библиотеки достаточно сложный и грязный, содержит много багов и легаси. Разобраться, как работает тот или иной блок, очень сложно. Если исправление багов разработчики принимают охотно, то при попытке добавить новую фичу можно сильно забуксовать и потратить очень большое количество времени на обсуждение (и в итоге фичу так и не примут). В нашей компании практически нет проектов на C++, поэтому разработчиков, которые могут поддерживать Drafter, очень мало, при этом необходимость в новых фичах возникает регулярно.

## Описание библиотеки

Библиотека **Crafter** — это замена Drafter, написанная на JavaScript, благодаря чему её легче поддерживать. Библиотека устраняет описанные выше недостатки оригинала и реализует все необходимые возможности:

* Resource Prototypes — возможность задать общие ответы для разных ресурсов в одном месте и переиспользовать их во всей документации;
* Подключение внешних apib-файлов, чтобы документация была модульной и более простой в использовании;
* Отключение fixed-type для массивов (в API Blueprint исторически сложилось, что описание типа как `array[SomeType]` значит, что в массиве могут быть элементы типа SomeType, а могут и не быть; более удобно, если такое описание значило бы, что в массиве должны быть только элементы типа SomeType);
* Возможность использовать массивы в GET-параметрах;
* Описание некоторых типов данных напрямую в JSON Schema;
* Валидации (длина строки, соответствие регулярному выражению).

## Запуск тестов

```
npm test
```
